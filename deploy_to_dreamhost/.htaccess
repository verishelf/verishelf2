# Enable Rewrite Engine
RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Don't process HTML as PHP
RemoveHandler .html .htm
DirectoryIndex index.html

# API Routes - Proxy to Node.js server (if using Apache proxy)
# Note: DreamHost Passenger handles this differently, but this is a fallback
RewriteCond %{REQUEST_URI} ^/api/(.*)$
RewriteRule ^api/(.*)$ http://localhost:3000/api/$1 [P,L]

# Dashboard - serve React app
# First, check if it's a file or directory that exists
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^dashboard/ - [L]

# If not a file/directory, serve index.html for dashboard routes
RewriteCond %{REQUEST_URI} ^/dashboard
RewriteRule ^dashboard/(.*)$ /dashboard/index.html [L]

# Don't rewrite if file exists (for root files)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Default: serve landing page at root
RewriteRule ^$ index.html [L]
